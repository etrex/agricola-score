# 專案決策記錄

## 已完成的決策
1. 使用 JavaScript 作為 CDK 開發語言，Ruby 作為 Lambda 函數開發語言
2. DynamoDB 使用 On-demand 容量模式
3. 使用 userId + sessionId 作為主鍵，並添加 GSI 支援查詢功能
4. 實作 TTL 機制來自動清理臨時資料
5. 建立開發和生產兩個環境

## 待決策事項（考慮免費額度範圍內的最佳實踐）

### 1. 安全性配置
#### 1.1 AWS WAF
- 決策：是否啟用 AWS WAF？
- 選項：
  1. 使用免費額度內的基本規則
  2. 不使用 WAF，僅依賴 API Gateway 內建的節流
- 決定：不使用 WAF，因為：
  1. 只接受來自 LINE 的請求
  2. 已有 LINE 簽名驗證
  3. API Gateway 的節流機制足夠

#### 1.2 API 存取限制
- 決策：如何限制 API 存取？
- 選項：
  1. 使用 API Gateway 的 Lambda 授權者驗證 LINE Webhook 請求
  2. 僅依賴 LINE 簽名驗證
- 決定：使用 LINE 簽名驗證，因為這已經足夠確保請求來自 LINE 平台

### 2. 監控配置
#### 2.1 X-Ray 追蹤
- 決策：是否啟用 X-Ray？
- 選項：
  1. 啟用 X-Ray 基本追蹤
  2. 僅使用 CloudWatch Logs
- 決定：啟用 X-Ray 基本追蹤（確認在免費額度內）

#### 2.2 CloudWatch Alarms
- 決策：是否需要額外的監控指標？
- 現有指標：
  - Lambda 錯誤
  - API Gateway 5xx 錯誤
  - DynamoDB 限流
- 決定增加的指標（確認在免費額度內）：
  1. Lambda 執行時間（p90 > 1s）
  2. API Gateway 4xx 錯誤（每分鐘 > 5）
  3. 成功率監控（< 95%）

### 3. 部署流程
#### 3.1 部署流程
- 決策：如何進行部署？
- 選項：
  1. 自動化 CI/CD 流程
  2. 單一指令部署腳本
- 決定：使用單一指令部署腳本（deploy.sh），保持簡單且可控

#### 3.2 環境配置
- 決策：需要哪些環境？
- 選項：
  1. 開發、測試、生產環境
  2. 開發和生產環境
- 決定：維持開發和生產兩個環境，足夠應付當前需求

### 4. 效能優化
#### 4.1 Lambda 配置
- 決策：Lambda 記憶體配置
- 選項：
  1. 128MB（目前配置）
  2. 256MB
  3. 512MB
- 建議：維持 128MB，目前負載下已足夠

#### 4.2 DynamoDB 快取
- 決策：是否使用 DAX？
- 選項：
  1. 實作 DAX
  2. 應用層面實作記憶體快取
  3. 不使用快取
- 決定：不使用快取，因為：
  1. 目前負載不高
  2. DAX 會產生額外成本
  3. DynamoDB 的基本讀寫效能已足夠

### 5. 維運策略
#### 5.1 備份策略
- 決策：DynamoDB 備份配置
- 選項：
  1. 使用 AWS Backup 自動備份
  2. 手動定期備份
  3. 不進行備份
- 決定：使用 DynamoDB 的免費持續備份（PITR），因為：
  1. 免費使用
  2. 提供 35 天的還原點
  3. 不需要額外的維護工作

#### 5.2 日誌保留
- 決策：日誌保留期限
- 選項：
  1. 7 天
  2. 14 天
  3. 30 天
- 決定：設為 14 天，因為：
  1. 在 CloudWatch Logs 免費額度內
  2. 提供更長的問題追蹤時間
  3. 與 X-Ray 追蹤資料保持一致

請審查以上決策建議，並指出您希望調整的部分。確認後我們可以開始實作相應的配置。